# 5. Git Integration and Version Control

## üîÑ What is Version Control?

Version control is a system that tracks changes to your code over time, allowing you to:
- **Track Changes**: See what was changed, when, and by whom
- **Collaborate**: Work with others on the same project
- **Rollback**: Revert to previous versions if needed
- **Branch**: Work on features without affecting the main code
- **Backup**: Keep your code safe and accessible

### Why Git for Android Development?
- **Industry Standard**: Most widely used version control system
- **Android Studio Integration**: Built-in Git support
- **GitHub Integration**: Easy sharing and collaboration
- **Branching**: Powerful feature development workflow
- **History**: Complete change history and blame tracking

## üöÄ Setting Up Git in Android Studio

### Initial Git Configuration
```bash
# Set your identity
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# Set default branch name
git config --global init.defaultBranch main

# Configure line endings
git config --global core.autocrlf input  # macOS/Linux
git config --global core.autocrlf true   # Windows
```

### Android Studio Git Settings
1. **File ‚Üí Settings ‚Üí Version Control ‚Üí Git**
2. **Path to Git executable**: Usually auto-detected
3. **Test connection**: Verify Git is working

## üìÅ Initializing a Git Repository

### Method 1: From Android Studio
1. **VCS ‚Üí Enable Version Control Integration**
2. **Select Git** from the dropdown
3. **Click OK** to initialize

### Method 2: Command Line
```bash
# Navigate to project directory
cd /path/to/your/android/project

# Initialize Git repository
git init

# Add all files to staging
git add .

# Make initial commit
git commit -m "Initial commit: Android project setup"
```

### .gitignore Configuration
Create a proper `.gitignore` file for Android projects:

```gitignore
# Built application files
*.apk
*.ap_
*.aab

# Files for the ART/Dalvik VM
*.dex

# Java class files
*.class

# Generated files
bin/
gen/
out/
release/

# Gradle files
.gradle/
build/

# Local configuration file (sdk path, etc)
local.properties

# Proguard folder generated by Eclipse
proguard/

# Log Files
*.log

# Android Studio Navigation editor temp files
.navigation/

# Android Studio captures folder
captures/

# IntelliJ
*.iml
.idea/workspace.xml
.idea/tasks.xml
.idea/gradle.xml
.idea/assetWizardSettings.xml
.idea/dictionaries
.idea/libraries
.idea/jarRepositories.xml

# Keystore files
*.jks
*.keystore

# External native build folder generated in Android Studio 2.2 and later
.externalNativeBuild
.cxx/

# Google Services (e.g. APIs or Firebase)
google-services.json

# Freeline
freeline.py
freeline/
freeline_project_description.json

# fastlane
fastlane/report.xml
fastlane/Preview.html
fastlane/screenshots
fastlane/test_output
fastlane/readme.md

# Version control
vcs.xml

# lint
lint/intermediates/
lint/generated/
lint/outputs/
lint/tmp/

# Android Profiling
*.hprof
```

## üîß Basic Git Operations

### Checking Status
```bash
# Check repository status
git status

# See changes in working directory
git diff

# See staged changes
git diff --cached
```

### Staging Changes
```bash
# Stage specific files
git add MainActivity.kt
git add app/src/main/res/layout/activity_main.xml

# Stage all changes
git add .

# Stage with interactive mode
git add -i
```

### Committing Changes
```bash
# Commit with message
git commit -m "Add button click functionality to MainActivity"

# Commit with detailed message
git commit -m "feat: implement user authentication

- Add login activity
- Implement password validation
- Add user session management

Closes #123"

# Amend last commit
git commit --amend -m "Updated commit message"
```

### Viewing History
```bash
# View commit history
git log

# View concise history
git log --oneline

# View history with graph
git log --graph --oneline --all

# View specific file history
git log --follow MainActivity.kt
```

## üåø Branching and Merging

### Creating Branches
```bash
# Create and switch to new branch
git checkout -b feature/user-authentication

# Create branch from specific commit
git checkout -b hotfix/crash-fix abc1234

# List all branches
git branch -a
```

### Switching Branches
```bash
# Switch to existing branch
git checkout main

# Switch to branch (Git 2.23+)
git switch main

# Switch to new branch
git switch -c feature/new-feature
```

### Merging Branches
```bash
# Merge feature branch into main
git checkout main
git merge feature/user-authentication

# Merge with no-fast-forward (creates merge commit)
git merge --no-ff feature/user-authentication

# Abort merge if conflicts
git merge --abort
```

### Resolving Merge Conflicts
When conflicts occur in files like `activity_main.xml`:

```xml
<<<<<<< HEAD
    <Button
        android:id="@+id/button"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Click Me" />
=======
    <Button
        android:id="@+id/button"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Submit" />
>>>>>>> feature/button-update
```

**Resolution:**
```xml
<Button
    android:id="@+id/button"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Submit" />
```

## üîó Remote Repositories

### Adding Remote Repository
```bash
# Add GitHub remote
git remote add origin https://github.com/username/android-app.git

# Add remote with SSH
git remote add origin git@github.com:username/android-app.git

# List remotes
git remote -v
```

### Pushing to Remote
```bash
# Push to remote repository
git push origin main

# Push new branch
git push -u origin feature/user-authentication

# Force push (use with caution)
git push --force origin main
```

### Pulling from Remote
```bash
# Pull latest changes
git pull origin main

# Pull specific branch
git pull origin feature/user-authentication

# Fetch without merging
git fetch origin
```

## üì± Android Studio Git Integration

### Git Toolbar
```
Git Toolbar
‚îú‚îÄ‚îÄ Update Project (Pull)     # Pull latest changes
‚îú‚îÄ‚îÄ Commit Changes            # Open commit dialog
‚îú‚îÄ‚îÄ Push                      # Push to remote
‚îú‚îÄ‚îÄ Show History              # View file history
‚îî‚îÄ‚îÄ Branches                  # Switch branches
```

### Commit Dialog
```yaml
Commit Dialog Features:
- File selection with checkboxes
- Commit message editor
- Pre-commit hooks
- Commit and push option
- Amend previous commit
```

### Version Control Window
```yaml
Version Control Window:
‚îú‚îÄ‚îÄ Local Changes Tab         # Uncommitted changes
‚îú‚îÄ‚îÄ Log Tab                   # Commit history
‚îú‚îÄ‚îÄ Branches Tab              # Branch management
‚îî‚îÄ‚îÄ Console Tab               # Git command output
```

## üîç Advanced Git Features

### Stashing Changes
```bash
# Stash current changes
git stash

# Stash with message
git stash push -m "WIP: working on authentication"

# List stashes
git stash list

# Apply stash
git stash pop

# Apply specific stash
git stash apply stash@{1}
```

### Cherry-picking
```bash
# Cherry-pick specific commit
git cherry-pick abc1234

# Cherry-pick range
git cherry-pick abc1234..def5678
```

### Rebasing
```bash
# Rebase feature branch on main
git checkout feature/user-authentication
git rebase main

# Interactive rebase
git rebase -i HEAD~3
```

### Tagging
```bash
# Create lightweight tag
git tag v1.0.0

# Create annotated tag
git tag -a v1.0.0 -m "Release version 1.0.0"

# Push tags
git push origin --tags
```

## üö® Git Best Practices

### Commit Messages
```bash
# Good commit messages
feat: add user authentication system
fix: resolve crash in MainActivity
docs: update README with setup instructions
style: format code according to style guide
refactor: extract authentication logic to separate class
test: add unit tests for UserRepository
chore: update dependencies to latest versions
```

### Branch Naming
```bash
# Feature branches
feature/user-authentication
feature/payment-integration
feature/push-notifications

# Bug fix branches
fix/crash-on-startup
fix/memory-leak-in-image-loader
fix/typo-in-error-message

# Hotfix branches
hotfix/security-vulnerability
hotfix/critical-crash
```

### Workflow
```yaml
# Git Flow
main: Production-ready code
develop: Integration branch
feature/*: New features
release/*: Release preparation
hotfix/*: Critical fixes
```

## üîß Git Hooks for Android

### Pre-commit Hook
```bash
#!/bin/sh
# .git/hooks/pre-commit

# Run linting
./gradlew lint

# Run tests
./gradlew test

# Check for TODO comments
if git diff --cached | grep -i "TODO"; then
    echo "Warning: TODO comments found in staged changes"
    exit 1
fi
```

### Commit Message Hook
```bash
#!/bin/sh
# .git/hooks/commit-msg

# Check commit message format
commit_regex='^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,50}'

if ! grep -qE "$commit_regex" "$1"; then
    echo "Invalid commit message format."
    echo "Use: type(scope): description"
    exit 1
fi
```

## üìä Git Visualization

### Git Graph in Android Studio
```yaml
Git Graph Features:
- Visual branch history
- Commit details
- File changes
- Merge conflicts
- Branch comparison
```

### Git Log Visualization
```bash
# ASCII graph
git log --graph --oneline --all

# Custom format
git log --pretty=format:"%h - %an, %ar : %s"
```

## üö® Troubleshooting

### Common Issues

#### Merge Conflicts
```bash
# See conflicted files
git status

# Resolve conflicts manually
# Edit conflicted files
# Remove conflict markers

# Add resolved files
git add .

# Complete merge
git commit
```

#### Lost Commits
```bash
# Find lost commits
git reflog

# Recover lost commit
git checkout -b recovery abc1234
```

#### Large Files
```bash
# Remove large file from history
git filter-branch --force --index-filter \
  'git rm --cached --ignore-unmatch large-file.apk' \
  --prune-empty --tag-name-filter cat -- --all
```

## üìö Additional Resources

### Official Documentation
- [Git Documentation](https://git-scm.com/doc)
- [GitHub Guides](https://guides.github.com/)
- [Git Flow](https://nvie.com/posts/a-successful-git-branching-model/)

### Android-Specific
- [Android Git Workflow](https://source.android.com/setup/develop)
- [Android Studio Version Control](https://developer.android.com/studio/intro#version-control)

### Best Practices
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Git Flow](https://nvie.com/posts/a-successful-git-branching-model/)
- [GitHub Flow](https://guides.github.com/introduction/flow/)

---

**Next**: [Debugging Tools and Logcat](./06-debugging-tools.md)
